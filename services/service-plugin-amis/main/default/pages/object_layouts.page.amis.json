{
    "type": "page",
    "body": [
        {
            "type": "form",
            "mode": "normal",
            "persistData": false,
            "promptPageLeave": true,
            "name": "form_edit_${recordId}",
            "title": "",
            "api": {
                "method": "post",
                "url": "${context.rootUrl}/graphql",
                "data": {
                    "objectName": "${objectName}",
                    "$": "$$",
                    "recordId": "${recordId}",
                    "modalName": "${modalName}"
                },
                "requestAdaptor": "\n        \n        const formData = api.data.$;\n        for (key in formData){\n            // image、select等字段清空值后保存的空字符串转换为null。\n            if(formData[key] === ''){\n                formData[key] = null;\n            }\n        }\n        const objectName = api.data.objectName;\n        const fieldsName = Object.keys(formData);\n        delete formData.created;\n        delete formData.created_by;\n        delete formData.modified;\n        delete formData.modified_by;\n        delete formData._display;\n        \n        \n        let query = `mutation{record: ${objectName}__insert(doc: {__saveData}){_id}}`;\n        if(formData.recordId){\n            query = `mutation{record: ${objectName}__update(id: \"${formData.recordId}\", doc: {__saveData}){_id}}`;\n        };\n        delete formData._id;\n        let __saveData = JSON.stringify(JSON.stringify(formData));\n    \n        api.data = {query: query.replace('{__saveData}', __saveData)};\n        return api;\n    ",
                "responseData": {
                    "recordId": "${record._id}"
                },
                "adaptor": "\n            SteedosUI.getRef(api.body.modalName).close();\n            SteedosUI.router.go({objectName: api.body.objectName, recordId: payload.data.record._id, type: api.body.recordId ? 'edit': 'new'});\n            return payload;\n        "
            },
            "initApi": {
                "method": "post",
                "url": "${context.rootUrl}/graphql",
                "sendOn": "!!this.recordId",
                "cache": 100,
                "adaptor": "var data = payload.data.data[0];\nif(data){\n    data.object_name = data.object_name ? data.object_name.name:null;\n    \n    \n    //初始化接口返回的字段移除字段值为null的字段\n    for (key in data){\n        if(data[key] === null){\n            delete data[key];\n        }\n    }\n};\npayload.data = data;\ndelete payload.extensions;\nreturn payload;\n",
                "data": {
                    "query": "{data:object_layouts(filters:[\"_id\", \"=\", \"${recordId}\"]){_id,name,label,object_name:object_name__expand{name,label},profiles,buttons,fields,related_lists,field_groups,created,created_by:created_by__expand{_id,name},modified,modified_by:modified_by__expand{_id,name},_display{created,modified}}}"
                }
            },
            "initFetch": true,
            "body": [
                {
                    "type": "fieldSet",
                    "title": "通用",
                    "collapsable": true,
                    "body": [
                        {
                            "name": "name",
                            "label": "API 名称",
                            "required": true,
                            "type": "input-text",
                            "className": "col-span-2 m-0",
                            "labelClassName": "text-left"
                        },
                        {
                            "name": "label",
                            "label": "页面布局名",
                            "required": true,
                            "type": "input-text",
                            "className": "col-span-2 m-0",
                            "labelClassName": "text-left"
                        },
                        {
                            "name": "object_name",
                            "label": "对象",
                            "required": true,
                            "type": "select",
                            "joinValues": false,
                            "extractValue": true,
                            "labelField": "label",
                            "valueField": "value",
                            "autoComplete": "get:/service/api/amis-metadata-objects/objects/options",
                            "className": "m-0",
                            "labelClassName": "text-left",
                            "en-US": {
                                "label": "Object"
                            },
                            "checkAll": false,
                            "searchable": true
                        },
                        {
                            "name": "profiles",
                            "label": "简档",
                            "required": true,
                            "type": "select",
                            "joinValues": false,
                            "extractValue": true,
                            "labelField": "label",
                            "multiple": true,
                            "className": "m-0",
                            "labelClassName": "text-left",
                            "checkAll": true,
                            "source": {
                                "method": "post",
                                "url": "${context.rootUrl}/graphql",
                                "data": {
                                    "query": "{options:permission_set(filters: [\"type\", \"=\", \"profile\"]){name,label}}"
                                },
                                "requestAdaptor": "",
                                "adaptor": ""
                            },
                            "valueField": "name",
                            "searchable": true
                        },
                        {
                            "type": "service",
                            "body": [
                                {
                                    "type": "panel",
                                    "title": "按钮",
                                    "body": [
                                        {
                                            "name": "buttons",
                                            "label": "按钮",
                                            "type": "crud",
                                            "strictMode": false,
                                            "affixHeader": false,
                                            "editable": true,
                                            "addable": false,
                                            "removable": true,
                                            "draggable": false,
                                            "columns": [
                                                {
                                                    "name": "index",
                                                    "label": "序号",
                                                    "type": "static",
                                                    "value": "${index + 1}",
                                                    "className": "w-10"
                                                },
                                                {
                                                    "name": "button_name_label",
                                                    "label": "名称",
                                                    "type": "tpl",
                                                    "tpl": "${buttons_options|filter:value:equals:button_name|pick:label}"
                                                },
                                                {
                                                    "name": "visible_on",
                                                    "label": "显示条件",
                                                    "quickEdit": {
                                                        "type": "input-text",
                                                        "className": "m-0",
                                                        "labelClassName": "text-left",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForButton:visible_on}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "tpl": "<b><%=data.visible_on%></b>"
                                                    }
                                                }
                                            ],
                                            "className": "col-span-2 m-0",
                                            "labelClassName": "text-left",
                                            "footable": false,
                                            "headerToolbar": [
                                                {
                                                    "type": "action",
                                                    "actionType": "dialog",
                                                    "dialog": {
                                                        "title": "选择按钮",
                                                        "body": [
                                                            {
                                                                "type": "transfer",
                                                                "name": "picked_buttons",
                                                                "sortable": true,
                                                                "source": "${buttons_options}",
                                                                "value": "${buttons|pick:button_name}",
                                                                "searchable": true
                                                            }
                                                        ],
                                                        "onEvent": {
                                                            "confirm": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|clearButtons}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    },
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|convertDataForButtons}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    "label": "选择按钮"
                                                }
                                            ],
                                            "source": "${buttons}"
                                        }
                                    ],
                                    "id": "u:1c6f542c9215",
                                    "inline": false,
                                    "affixFooter": false,
                                    "className": "m-0",
                                    "headerClassName": "antd-Panel-heading pl-0",
                                    "bodyClassName": "antd-Panel-body p-0"
                                }
                            ],
                            "id": "u:bef2e378d96f",
                            "messages": {},
                            "api": {
                                "method": "get",
                                "url": "/service/api/amis-metadata-objects/objects/${object_name}/actions/options",
                                "adaptor": "// 把”选择按钮“弹出窗口中设置的按钮转为主表单buttons字段值格式\namis.registerFilter('convertDataForButtons', function (input) {\n  let pickedButtons = input.picked_buttons || [];\n  const superButtons = _.keyBy(input.__super.buttons, 'button_name');\n  if (typeof pickedButtons === \"string\") {\n    pickedButtons = pickedButtons.split(\",\");\n  }\n  const convertedButtons = pickedButtons.map(function (key) {\n    return superButtons[key] || {\n      button_name: key\n    }\n  });\n  return {\n    buttons: convertedButtons\n  }\n});\n\n// 按钮列表每一列数据变量时立即同步值到表单中\namis.registerFilter('quickEidtSaveForButton', function (input, prop_name) {\n  const currentPropValue = input.value;\n  const rowValue = input.__super;\n  const formValue = input.__super.__super.__super;\n  const button_name = rowValue.button_name;\n  rowValue[prop_name] = currentPropValue;\n  let newButtons = formValue.buttons.map(function (item) {\n    if (item.button_name == button_name) {\n      return Object.assign({}, item, rowValue);\n    }\n    else {\n      return item;\n    }\n  });\n  return {\n    buttons: newButtons\n  }\n});\n\n// 清空主表单buttons字段值\namis.registerFilter('clearButtons', function (input) {\n  return {\n    buttons: []\n  }\n});\n\n\n// 新建页面布局时初始化buttons默认值，字段值是CRUD表格控件渲染，新建页面布局时，不会自动填充到form中，需要手动填充\namis.registerFilter('initDefaultButtons', function (input) {\n  const superValues = this.data.__super || {};\n  if (superValues.recordId) {\n    // 编辑记录本来就会初始化相关字段值，不需要再初始化\n    return;\n  }\n  return {\n    buttons: superValues.buttons,\n  }\n});\n\nlet data = payload.data;\ndata.buttons_options = data.options;\ndelete data.options\npayload.data = data;\nreturn payload;\n",
                                "sendOn": "!!this.object_name"
                            },
                            "className": "col-span-2 m-0",
                            "affixFooter": false
                        },
                        {
                            "type": "service",
                            "body": [
                                {
                                    "type": "panel",
                                    "title": "字段",
                                    "body": [
                                        {
                                            "name": "fields",
                                            "required": true,
                                            "type": "crud",
                                            "strictMode": false,
                                            "affixHeader": false,
                                            "editable": true,
                                            "addable": false,
                                            "removable": true,
                                            "draggable": false,
                                            "columns": [
                                                {
                                                    "name": "index",
                                                    "className": "w-10",
                                                    "label": "序号",
                                                    "type": "static",
                                                    "value": "${index + 1}"
                                                },
                                                {
                                                    "name": "field_name_label",
                                                    "label": "字段",
                                                    "type": "tpl",
                                                    "tpl": "${fields_options|filter:value:equals:field_name|pick:label}"
                                                },
                                                {
                                                    "name": "is_readonly",
                                                    "label": "只读",
                                                    "quickEdit": {
                                                        "type": "checkbox",
                                                        "tpl": null,
                                                        "className": "m-0",
                                                        "labelClassName": "text-left",
                                                        "mode": "inline",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForField:is_readonly}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "name": "is_required",
                                                    "label": "必填",
                                                    "quickEdit": {
                                                        "mode": "inline",
                                                        "type": "checkbox",
                                                        "className": "m-0",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForField:is_required}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "tpl": null,
                                                        "labelClassName": "text-left"
                                                    }
                                                },
                                                {
                                                    "name": "group",
                                                    "label": "分组",
                                                    "quickEdit": {
                                                        "type": "select",
                                                        "className": "m-0",
                                                        "source": "${field_groups|pick:group_name}",
                                                        "checkAll": false,
                                                        "selectFirst": false,
                                                        "searchable": true,
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|clearFields}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    },
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForField:group}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "name": "visible_on",
                                                    "label": "显示条件",
                                                    "quickEdit": {
                                                        "type": "textarea",
                                                        "tpl": "<b><%=data.visible_on%></b>",
                                                        "className": "m-0",
                                                        "labelClassName": "text-left",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForField:visible_on}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    "breakpoint": "*"
                                                }
                                            ],
                                            "className": "col-span-2 m-0",
                                            "labelClassName": "text-left",
                                            "source": "${fields}",
                                            "footable": false,
                                            "headerToolbar": [
                                                {
                                                    "type": "action",
                                                    "actionType": "dialog",
                                                    "dialog": {
                                                        "title": "选择字段",
                                                        "body": [
                                                            {
                                                                "type": "transfer",
                                                                "name": "picked_fields",
                                                                "sortable": true,
                                                                "source": "${fields_options}",
                                                                "value": "${fields|pick:field_name}",
                                                                "searchable": true
                                                            }
                                                        ],
                                                        "onEvent": {
                                                            "confirm": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|clearFields}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    },
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|convertDataForFields}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    "label": "选择字段"
                                                },
                                                {
                                                    "type": "action",
                                                    "actionType": "dialog",
                                                    "dialog": {
                                                        "title": "设置分组",
                                                        "body": [
                                                            {
                                                                "type": "input-table",
                                                                "name": "setting_groups",
                                                                "addable": true,
                                                                "draggable": true,
                                                                "editable": true,
                                                                "columns": [
                                                                    {
                                                                        "name": "group_name",
                                                                        "label": "名称"
                                                                    }
                                                                ],
                                                                "value": "${field_groups}",
                                                                "removable": true
                                                            }
                                                        ],
                                                        "onEvent": {
                                                            "confirm": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|clearFields}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    },
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|convertDataForGroups}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "type": "dialog"
                                                    },
                                                    "label": "设置分组"
                                                }
                                            ]
                                        }
                                    ],
                                    "id": "u:acfaf85221b7",
                                    "inline": false,
                                    "affixFooter": false,
                                    "className": "m-0",
                                    "headerClassName": "antd-Panel-heading pl-0",
                                    "bodyClassName": "antd-Panel-body p-0"
                                }
                            ],
                            "id": "u:ac5b7818b88f",
                            "affixFooter": false,
                            "messages": {},
                            "api": {
                                "method": "get",
                                "url": "/service/api/amis-metadata-objects/objects/${object_name}/fields/layout_options",
                                "adaptor": "const fieldGroupKey = \"group\";\nconst getFieldsSortFun = function(groupNames){\n  return function(m,n){\n    var tempM = !!m[fieldGroupKey] ? 1 : 0;\n    var tempN = !!n[fieldGroupKey] ? 1 : 0;\n    if(!m[fieldGroupKey] || !n[fieldGroupKey]){\n      // 没有配置group属性的字段排在前面\n      return tempM - tempN;\n    }\n    // 字段所属分组不在groupNames时排在前面，其他字段按其所属分组在groupNames中的排序先后顺序排序，所属分组相同的字段排在一起。\n    return groupNames.indexOf(m[fieldGroupKey]) - groupNames.indexOf(n[fieldGroupKey]);\n  };\n}\n\n// 把”选择字段“弹出窗口中设置的字段转为主表单fields字段值格式\namis.registerFilter('convertDataForFields', function (input) {\n  let pickedFields = input.picked_fields || [];\n  const superFields = _.keyBy(input.__super.fields, 'field_name');\n  if(typeof pickedFields === \"string\"){\n    pickedFields = pickedFields.split(\",\");\n  }\n  const fieldOptions = lodash.keyBy(this.data.__super.__super.__super.__super.__super.fields_options, \"value\");\n  const convertedFields = pickedFields.map(function (field_name) {\n    const superField = superFields[field_name];\n    if (superField) {\n      return superField;\n    }\n    else {\n      const fieldOption = fieldOptions[field_name];\n      return {\n        field_name: field_name,\n        is_readonly: fieldOption.readonly,\n        is_required: fieldOption.required,\n        group: fieldOption.group\n      }\n    }\n  });\n  const fieldGroups = this.data.__super.__super.__super.__super.__super.field_groups;\n  const groupNames = lodash.compact(lodash.map(fieldGroups,\"group_name\"));\n  // fields重新按分组排序\n  convertedFields.sort(getFieldsSortFun(groupNames));\n  return {\n    fields: convertedFields\n  }\n});\n\n// 字段列表每一列数据变量时立即同步值到表单中\namis.registerFilter('quickEidtSaveForField', function (input, prop_name) {\n  const currentPropValue = input.value;\n  const rowValue = input.__super;\n  const formValue = input.__super.__super.__super;\n  const field_name = rowValue.field_name;\n  rowValue[prop_name] = currentPropValue;\n  let newFields = formValue.fields.map(function (item) {\n    if (item.field_name == field_name) {\n      return Object.assign({}, item, rowValue);\n    }\n    else { \n      return item;\n    }\n  });\n  const fieldGroups = this.data.__super.__super.field_groups;\n  const groupNames = lodash.compact(lodash.map(fieldGroups,\"group_name\"));\n  // fields重新按分组排序\n  newFields.sort(getFieldsSortFun(groupNames));\n  return {\n    fields: newFields\n  }\n});\n\n// 清空主表单fields字段值\namis.registerFilter('clearFields', function (input) {\n  return {\n    fields: []\n  }\n});\n\n// 把”设置分组“弹出窗口中设置的分组转为主表单groups字段值格式\n// 同时根据新的groups排序重新设置fields属性的字段先后次序\n// 因为直接设置fields值有bug，即新值老值会串，所以需要先执行上面的clearFields清除原来的值\namis.registerFilter('convertDataForGroups', function (input) {\n  const settingGroups = input.setting_groups || [];\n  const convertedGroups = lodash.uniqBy(settingGroups.map(function (item) {\n    return {\n      group_name: item.group_name\n    }\n  }), \"group_name\");\n\n  const groupNames = lodash.compact(lodash.map(convertedGroups,\"group_name\"));\n  const fields = this.data.__super.__super.items;\n  // fields重新按分组排序\n  fields.sort(getFieldsSortFun(groupNames));\n\n  return {\n    field_groups: convertedGroups, \n    fields: fields\n  }\n});\n\n// 把字段中配置的group属性加到主表field_groups属性中\namis.registerFilter('mixingGroupsFromFields', function (input) {\n  const groupsOptions = input.field_groups_options;\n  const groups = this.data.field_groups || [];\n  const groupsForMixing = groupsOptions.map(function (item) {\n    return {\n      group_name: item\n    }\n  });\n  const mixedGroups = lodash.unionBy(groups, groupsForMixing, \"group_name\");\n  return {\n    field_groups: mixedGroups\n  }\n});\n\n// 新建页面布局时初始化fields默认值，字段值是CRUD表格控件渲染，新建页面布局时，不会自动填充到form中，需要手动填充\namis.registerFilter('initDefaultFields', function (input) {\n  const superValues = this.data.__super || {};\n  if (superValues.recordId) {\n    // 编辑记录本来就会初始化相关字段值，不需要再初始化\n    return;\n  }\n  return {\n    fields: superValues.fields,\n  }\n});\n\nlet data = payload.data;\ndata.fields_options = data.options;\ndata.field_groups_options = lodash.uniq(lodash.compact(lodash.map(data.options, \"group\"))) || [];\ndelete data.options\npayload.data = data;\nreturn payload;\n",
                                "sendOn": "!!this.object_name",
                                "data": null
                            },
                            "className": "col-span-2 m-0",
                            "placeholder": "-",
                            "onEvent": {
                                "fetchInited": {
                                    "actions": [
                                        {
                                            "actionType": "setValue",
                                            "args": {
                                                "value": "${event.data|mixingGroupsFromFields}"
                                            },
                                            "componentId": "object-layout-form"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "service",
                            "body": [
                                {
                                    "type": "panel",
                                    "title": "子表",
                                    "body": [
                                        {
                                            "name": "related_lists",
                                            "type": "crud",
                                            "strictMode": false,
                                            "affixHeader": false,
                                            "editable": true,
                                            "addable": true,
                                            "removable": true,
                                            "draggable": false,
                                            "columns": [
                                                {
                                                    "name": "index",
                                                    "label": "序号",
                                                    "className": "w-10",
                                                    "type": "static",
                                                    "value": "${index + 1}"
                                                },
                                                {
                                                    "name": "related_field_fullname_label",
                                                    "label": "子表名称",
                                                    "type": "tpl",
                                                    "tpl": "${related_lists_options|filter:value:equals:related_field_fullname|pick:label}"
                                                },
                                                {
                                                    "name": "label",
                                                    "label": "显示标题",
                                                    "quickEdit": {
                                                        "type": "input-text",
                                                        "mode": "inline",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:label}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "labelRemark": "默认为对象名称",
                                                        "className": "m-0",
                                                        "labelClassName": "text-left"
                                                    }
                                                },
                                                {
                                                    "name": "field_names",
                                                    "label": "显示的字段",
                                                    "quickEdit": {
                                                        "type": "transfer-picker",
                                                        "source": "/service/api/amis-metadata-objects/objects/${related_field_fullname|split:.|first}/fields/options",
                                                        "searchable": true,
                                                        "mode": "inline",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:field_names}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "joinValues": false,
                                                        "extractValue": true
                                                    }
                                                },
                                                {
                                                    "name": "sort_field_name",
                                                    "label": "排序字段",
                                                    "quickEdit": {
                                                        "type": "transfer-picker",
                                                        "joinValues": false,
                                                        "extractValue": true,
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:sort_field_name}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "source": "/service/api/amis-metadata-objects/objects/${related_field_fullname|split:.|first}/fields/options",
                                                        "searchable": true,
                                                        "mode": "inline"
                                                    },
                                                    "breakpoint": "*"
                                                },
                                                {
                                                    "name": "sort_order",
                                                    "label": "排序方式",
                                                    "quickEdit": {
                                                        "type": "select",
                                                        "tpl": null,
                                                        "className": "m-0",
                                                        "labelClassName": "text-left",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:sort_order}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "joinValues": false,
                                                        "options": [
                                                            {
                                                                "label": "正序",
                                                                "value": "asc"
                                                            },
                                                            {
                                                                "label": "倒序",
                                                                "value": "desc"
                                                            }
                                                        ],
                                                        "extractValue": true,
                                                        "clearable": true,
                                                        "labelField": "label",
                                                        "valueField": "value",
                                                        "mode": "inline"
                                                    },
                                                    "breakpoint": "*"
                                                },
                                                {
                                                    "name": "filters",
                                                    "label": "过滤规则",
                                                    "quickEdit": {
                                                        "type": "textarea",
                                                        "tpl": "<b><%=data.filters%></b>",
                                                        "className": "col-span-2 m-0",
                                                        "labelClassName": "text-left",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:filters}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    "breakpoint": "*"
                                                },
                                                {
                                                    "name": "visible_on",
                                                    "label": "显示条件",
                                                    "quickEdit": {
                                                        "type": "textarea",
                                                        "className": "m-0",
                                                        "labelClassName": "text-left",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:visible_on}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "tpl": "<b><%=data.visible_on%></b>"
                                                    },
                                                    "breakpoint": "*"
                                                },
                                                {
                                                    "name": "page_size",
                                                    "label": "每页显示数量",
                                                    "quickEdit": {
                                                        "type": "input-number",
                                                        "precision": 0,
                                                        "className": "m-0",
                                                        "labelClassName": "text-left",
                                                        "onEvent": {
                                                            "change": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|quickEidtSaveForRelatedList:page_size}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    "breakpoint": "*"
                                                }
                                            ],
                                            "className": "col-span-2 m-0",
                                            "labelClassName": "text-left",
                                            "headerToolbar": [
                                                {
                                                    "type": "action",
                                                    "actionType": "dialog",
                                                    "dialog": {
                                                        "title": "选择子表",
                                                        "body": [
                                                            {
                                                                "type": "transfer",
                                                                "name": "picked_related_lists",
                                                                "sortable": true,
                                                                "source": "${related_lists_options}",
                                                                "value": "${related_lists|pick:related_field_fullname}",
                                                                "searchable": true
                                                            }
                                                        ],
                                                        "onEvent": {
                                                            "confirm": {
                                                                "actions": [
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|clearRelatedLists}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    },
                                                                    {
                                                                        "actionType": "setValue",
                                                                        "args": {
                                                                            "value": "${event.data|convertDataForRelatedLists}"
                                                                        },
                                                                        "componentId": "object-layout-form"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    "label": "选择子表"
                                                }
                                            ],
                                            "source": "${related_lists}",
                                            "footable": false,
                                            "columnsTogglable": true,
                                            "messages": {},
                                            "tableClassName": "min-w-max"
                                        }
                                    ],
                                    "id": "u:2d4c3fe14984",
                                    "inline": false,
                                    "affixFooter": false,
                                    "headerClassName": "antd-Panel-heading pl-0",
                                    "className": "m-0",
                                    "bodyClassName": "antd-Panel-body p-0"
                                }
                            ],
                            "id": "u:dbadaff47153",
                            "messages": {},
                            "api": {
                                "method": "get",
                                "url": "/service/api/amis-metadata-objects/objects/${object_name}/relatedLists/options",
                                "sendOn": "!!this.object_name",
                                "adaptor": "// 把”选择子表“弹出窗口中设置的子表转为主表单related_lists字段值格式\namis.registerFilter('convertDataForRelatedLists', function (input) {\n  let pickedRelateds = input.picked_related_lists || [];\n  const superRelateds = _.keyBy(input.__super.related_lists, 'related_field_fullname');\n  if (typeof pickedRelateds === \"string\") {\n    pickedRelateds = pickedRelateds.split(\",\");\n  }\n  const convertedRelateds = pickedRelateds.map(function (key) {\n    return superRelateds[key] || {\n      related_field_fullname: key,\n      sort_order: \"asc\"\n    }\n  });\n  return {\n    related_lists: convertedRelateds\n  }\n});\n\n// 字段列表每一列数据变量时立即同步值到表单中\namis.registerFilter('quickEidtSaveForRelatedList', function (input, prop_name) {\n  const currentPropValue = input.value;\n  const rowValue = this.data;\n  delete rowValue.event;\n  const formValue = rowValue.__super.__super;\n  const related_field_fullname = rowValue.related_field_fullname;\n  rowValue[prop_name] = currentPropValue;\n  let newRelatedLists = formValue.related_lists.map(function (item) {\n    if (item.related_field_fullname == related_field_fullname) {\n      if (prop_name === \"related_field_fullname\") {\n        // 直接在表格上变更子表选项的话，清除其他属性值\n        return {\n          related_field_fullname: currentPropValue,\n          sort_order: \"asc\"\n        }\n      }\n      else {\n        return Object.assign({}, item, rowValue);\n      }\n    }\n    else {\n      return item;\n    }\n  });\n  return {\n    related_lists: newRelatedLists\n  }\n});\n\n// 清空主表单fields字段值\namis.registerFilter('clearRelatedLists', function (input) {\n  return {\n    related_lists: []\n  }\n});\n\n// 新建页面布局时初始化related_lists默认值，字段值是CRUD表格控件渲染，新建页面布局时，不会自动填充到form中，需要手动填充\namis.registerFilter('initDefaultRelatedLists', function (input) {\n  const superValues = this.data.__super || {};\n  if (superValues.recordId) {\n    // 编辑记录本来就会初始化相关字段值，不需要再初始化\n    return;\n  }\n  return {\n    related_lists: superValues.related_lists,\n  }\n});\n\nlet data = payload.data;\ndata.related_lists_options = data.options;\ndelete data.options\npayload.data = data;\nreturn payload;\n"
                            },
                            "className": "col-span-2 m-0"
                        }
                    ]
                }
            ],
            "panelClassName": "m-0",
            "bodyClassName": "p-4",
            "actions": [
                {
                    "type": "button",
                    "label": "取消",
                    "actionType": "",
                    "level": "default",
                    "block": false,
                    "onClick": "SteedosUI.getRef(props.data.__super.modalName).close();"
                },
                {
                    "type": "button",
                    "label": "保存",
                    "actionType": "submit",
                    "level": "info"
                }
            ],
            "actionsClassName": "p-sm b-t b-light text-center",
            "className": "steedos-amis-form",
            "checkAll": false,
            "id": "object-layout-form",
            "onEvent": {
                "inited": {
                    "actions": [
                        {
                            "actionType": "setValue",
                            "args": {
                                "value": "${event.data|initDefaultButtons}"
                            }
                        },
                        {
                            "actionType": "setValue",
                            "args": {
                                "value": "${event.data|initDefaultFields}"
                            }
                        },
                        {
                            "actionType": "setValue",
                            "args": {
                                "value": "${event.data|initDefaultRelatedLists}"
                            }
                        }
                    ]
                }
            }
        }
    ],
    "regions": [
        "body"
    ],
    "data": {
        "objectName": "object_layouts",
        "context": {
            "rootUrl": "http://127.0.0.1:5800",
            "tenantId": "hKdnwE55WcnWveYxS",
            "userId": "62ede4f62161e377e35de58c",
            "authToken": "20ec4d08e58513a09df7a5a5f2f5fb40d52e3e1722de92970a16be9d3db27dc50be21a5c8e9cab1caa7932"
        }
    },
    "bodyClassName": "p-0",
    "name": "page_edit_${recordId}",
    "initApi": null,
    "initFetch": null,
    "className": "page-form-object_layouts"
}